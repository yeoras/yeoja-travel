<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="agd-partner-manual-verification" /> 
    <title>YEOJA - ì—¬í–‰ì ê²¬ì  ìë™í™” ì‹œìŠ¤í…œ</title>
    
    <!-- 1. í…Œì¼ìœˆë“œ CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. ë¦¬ì•¡íŠ¸ & ë°”ë²¨ -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 3. í°íŠ¸ì–´ì¸ ì•„ì´ì½˜ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- 4. í°íŠ¸ -->
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">

    <style>
        * { font-family: 'Jua', sans-serif; }
        .soft-shadow { box-shadow: 0 8px 24px rgba(149, 157, 165, 0.1); }
        .btn-press:active { transform: scale(0.98); }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .animate-pop { animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .input-base { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #EEE; background-color: #FAFAFA; font-size: 14px; outline: none; transition: all 0.2s; }
        .input-base:focus { border-color: #FB923C; background-color: #FFF; }
        .icon-wrapper { display: inline-flex; align-items: center; justify-content: center; }
        .rank-bar { transition: width 1s ease-out; }
    </style>
</head>
<body class="bg-[#F9F5F0]">
    <div id="root"></div>

    <script type="text/babel">
        window.onerror = function(msg, url, line) {
            console.error("ì˜¤ë¥˜ ë°œìƒ:", msg);
            return false;
        };

        const { useState, useEffect, useRef, useMemo } = React;

        // --- ì•„ì´ì½˜ ì»´í¬ë„ŒíŠ¸ ---
        const Icon = ({ name, className, onClick }) => <i onClick={onClick} className={`fa-solid ${name} ${className} icon-wrapper`}></i>;
        const Plane = (p) => <Icon name="fa-plane" {...p} />;
        const Hotel = (p) => <Icon name="fa-hotel" {...p} />;
        const Coffee = (p) => <Icon name="fa-mug-hot" {...p} />;
        const Calculator = (p) => <Icon name="fa-calculator" {...p} />;
        const Search = (p) => <Icon name="fa-magnifying-glass" {...p} />;
        const User = (p) => <Icon name="fa-user" {...p} />;
        const Heart = (p) => <Icon name="fa-heart" {...p} />;
        const Users = (p) => <Icon name="fa-users" {...p} />;
        const Briefcase = (p) => <Icon name="fa-briefcase" {...p} />;
        const ChevronRight = (p) => <Icon name="fa-chevron-right" {...p} />;
        const ArrowLeft = (p) => <Icon name="fa-arrow-left" {...p} />;
        const RotateCcw = (p) => <Icon name="fa-rotate-left" {...p} />;
        const Star = (p) => <Icon name="fa-star" {...p} />;
        const Sparkles = (p) => <Icon name="fa-wand-magic-sparkles" {...p} />;
        const Smile = (p) => <Icon name="fa-face-smile" {...p} />;
        const Sun = (p) => <Icon name="fa-sun" {...p} />;
        const MessageSquare = (p) => <Icon name="fa-comment" {...p} />;
        const DollarSign = (p) => <Icon name="fa-dollar-sign" {...p} />;
        const X = (p) => <Icon name="fa-xmark" {...p} />;
        const Send = (p) => <Icon name="fa-paper-plane" {...p} />;
        const Share2 = (p) => <Icon name="fa-share-nodes" {...p} />;
        const Copy = (p) => <Icon name="fa-copy" {...p} />;
        const LogIn = (p) => <Icon name="fa-right-to-bracket" {...p} />;
        const UserPlus = (p) => <Icon name="fa-user-plus" {...p} />;
        const CheckCircle = (p) => <Icon name="fa-circle-check" {...p} />;
        const AlertCircle = (p) => <Icon name="fa-circle-exclamation" {...p} />;
        const PlayCircle = (p) => <Icon name="fa-circle-play" {...p} />;
        const Gift = (p) => <Icon name="fa-gift" {...p} />;
        const Trophy = (p) => <Icon name="fa-trophy" {...p} />;
        const Camera = (p) => <Icon name="fa-camera" {...p} />;
        const Trash = (p) => <Icon name="fa-trash" {...p} />;
        const Edit = (p) => <Icon name="fa-pen-to-square" {...p} />;

        // --- ë°ì´í„° ---
        const PRICE_TIERS = {
            1: { flight: 350000, hostel: 8000, airbnb: 30000, hotel: 60000, food: 5000, coffee: 2000 },
            2: { flight: 450000, hostel: 15000, airbnb: 50000, hotel: 100000, food: 10000, coffee: 3000 },
            3: { flight: 550000, hostel: 35000, airbnb: 90000, hotel: 150000, food: 20000, coffee: 5000 },
            4: { flight: 1200000, hostel: 60000, airbnb: 150000, hotel: 250000, food: 35000, coffee: 7000 },
            5: { flight: 1600000, hostel: 100000, airbnb: 250000, hotel: 400000, food: 50000, coffee: 9000 }
        };

        const RAW_CITIES = [
            ['ì¹˜ì•™ë§ˆì´ (íƒœêµ­)', 1], ['ë¹ ì´ (íƒœêµ­)', 1], ['ì¹˜ì•™ë¼ì´ (íƒœêµ­)', 1], ['ë°©ì½• (íƒœêµ­)', 2], ['í‘¸ì¼“ (íƒœêµ­)', 2], ['í¬ë¼ë¹„ (íƒœêµ­)', 2], ['ì½”ì‚¬ë¬´ì´ (íƒœêµ­)', 2], ['íŒŒíƒ€ì•¼ (íƒœêµ­)', 2],
            ['í•˜ë…¸ì´ (ë² íŠ¸ë‚¨)', 1], ['í˜¸ì¹˜ë¯¼ (ë² íŠ¸ë‚¨)', 2], ['ë‹¤ë‚­ (ë² íŠ¸ë‚¨)', 2], ['ë‚˜íŠ¸ë‘ (ë² íŠ¸ë‚¨)', 2], ['í‘¸ê¾¸ì˜¥ (ë² íŠ¸ë‚¨)', 2], ['ë‹¬ë (ë² íŠ¸ë‚¨)', 1], ['í˜¸ì´ì•ˆ (ë² íŠ¸ë‚¨)', 2],
            ['ë°œë¦¬ (ì¸ë„ë„¤ì‹œì•„)', 2], ['ìì¹´ë¥´íƒ€ (ì¸ë„ë„¤ì‹œì•„)', 2], ['ë¡¬ë³µ (ì¸ë„ë„¤ì‹œì•„)', 2], ['ê¸¸ë¦¬ (ì¸ë„ë„¤ì‹œì•„)', 2],
            ['ì„¸ë¶€ (í•„ë¦¬í•€)', 2], ['ë³´ë¼ì¹´ì´ (í•„ë¦¬í•€)', 2], ['ë§ˆë‹ë¼ (í•„ë¦¬í•€)', 2], ['ë³´í™€ (í•„ë¦¬í•€)', 2], ['íŒ”ë¼ì™„ (í•„ë¦¬í•€)', 2],
            ['ë¹„ì—”í‹°ì•ˆ (ë¼ì˜¤ìŠ¤)', 1], ['ë£¨ì•™í”„ë¼ë°© (ë¼ì˜¤ìŠ¤)', 1], ['ë°©ë¹„ì—¥ (ë¼ì˜¤ìŠ¤)', 1],
            ['í”„ë†ˆíœ (ìº„ë³´ë””ì•„)', 1], ['ì”¨ì— ë¦½ (ìº„ë³´ë””ì•„)', 1],
            ['ì¿ ì•Œë¼ë£¸í‘¸ë¥´ (ë§ë ˆì´ì‹œì•„)', 2], ['í˜ë‚­ (ë§ë ˆì´ì‹œì•„)', 2], ['ì½”íƒ€í‚¤ë‚˜ë°œë£¨ (ë§ë ˆì´ì‹œì•„)', 2],
            ['ì‹±ê°€í¬ë¥´', 4], 
            ['íƒ€ì´ë² ì´ (ëŒ€ë§Œ)', 2], ['ê°€ì˜¤ìŠ (ëŒ€ë§Œ)', 2], ['íƒ€ì´ë‚œ (ëŒ€ë§Œ)', 2],
            ['ë„ì¿„ (ì¼ë³¸)', 3], ['ì˜¤ì‚¬ì¹´ (ì¼ë³¸)', 3], ['êµí†  (ì¼ë³¸)', 3], ['í›„ì¿ ì˜¤ì¹´ (ì¼ë³¸)', 3], ['ì‚¿í¬ë¡œ (ì¼ë³¸)', 3], ['ì˜¤í‚¤ë‚˜ì™€ (ì¼ë³¸)', 3], ['ë‚˜ê³ ì•¼ (ì¼ë³¸)', 3], ['ê³ ë²  (ì¼ë³¸)', 3],
            ['í™ì½©', 3], ['ë§ˆì¹´ì˜¤', 3], ['ë² ì´ì§• (ì¤‘êµ­)', 3], ['ìƒí•˜ì´ (ì¤‘êµ­)', 3], ['ì¹­ë‹¤ì˜¤ (ì¤‘êµ­)', 2],
            ['ë‰´ë¸ë¦¬ (ì¸ë„)', 1], ['ë­„ë°”ì´ (ì¸ë„)', 2], ['ê³ ì•„ (ì¸ë„)', 1], ['ìì´í‘¸ë¥´ (ì¸ë„)', 1],
            ['ì¹´íŠ¸ë§Œë‘ (ë„¤íŒ”)', 1], ['í¬ì¹´ë¼ (ë„¤íŒ”)', 1],
            ['ìš¸ë€ë°”í† ë¥´ (ëª½ê³¨)', 2], ['ë¸”ë¼ë””ë³´ìŠ¤í† í¬ (ëŸ¬ì‹œì•„)', 2],
            ['ëŸ°ë˜ (ì˜êµ­)', 5], ['ì—ë”˜ë²„ëŸ¬ (ì˜êµ­)', 4], ['ë§¨ì²´ìŠ¤í„° (ì˜êµ­)', 4],
            ['íŒŒë¦¬ (í”„ë‘ìŠ¤)', 4], ['ë‹ˆìŠ¤ (í”„ë‘ìŠ¤)', 4], ['ë§ˆë¥´ì„¸ìœ  (í”„ë‘ìŠ¤)', 4], ['ë¦¬ì˜¹ (í”„ë‘ìŠ¤)', 4],
            ['ë¡œë§ˆ (ì´íƒˆë¦¬ì•„)', 4], ['ë°€ë¼ë…¸ (ì´íƒˆë¦¬ì•„)', 4], ['ë² ë„¤ì¹˜ì•„ (ì´íƒˆë¦¬ì•„)', 4], ['í”¼ë Œì²´ (ì´íƒˆë¦¬ì•„)', 4], ['ë‚˜í´ë¦¬ (ì´íƒˆë¦¬ì•„)', 3],
            ['ë°”ë¥´ì…€ë¡œë‚˜ (ìŠ¤í˜ì¸)', 4], ['ë§ˆë“œë¦¬ë“œ (ìŠ¤í˜ì¸)', 3], ['ì„¸ë¹„ì•¼ (ìŠ¤í˜ì¸)', 3], ['ê·¸ë¼ë‚˜ë‹¤ (ìŠ¤í˜ì¸)', 3], ['ë°œë Œì‹œì•„ (ìŠ¤í˜ì¸)', 3],
            ['ë¦¬ìŠ¤ë³¸ (í¬ë¥´íˆ¬ê°ˆ)', 3], ['í¬ë¥´íˆ¬ (í¬ë¥´íˆ¬ê°ˆ)', 3],
            ['ë² ë¥¼ë¦° (ë…ì¼)', 4], ['ë®Œí—¨ (ë…ì¼)', 4], ['í”„ë‘í¬í‘¸ë¥´íŠ¸ (ë…ì¼)', 4], ['í•¨ë¶€ë¥´í¬ (ë…ì¼)', 4],
            ['ì•”ìŠ¤í…Œë¥´ë‹´ (ë„¤ëœë€ë“œ)', 4], ['ë¸Œë¤¼ì…€ (ë²¨ê¸°ì—)', 4],
            ['í”„ë¼í•˜ (ì²´ì½”)', 3], ['ë¶€ë‹¤í˜ìŠ¤íŠ¸ (í—ê°€ë¦¬)', 3], ['ë¹„ì—”ë‚˜ (ì˜¤ìŠ¤íŠ¸ë¦¬ì•„)', 4], ['ì˜ì¸ ë¶€ë¥´í¬ (ì˜¤ìŠ¤íŠ¸ë¦¬ì•„)', 4],
            ['ì·¨ë¦¬íˆ (ìŠ¤ìœ„ìŠ¤)', 5], ['ì œë„¤ë°” (ìŠ¤ìœ„ìŠ¤)', 5], ['ì¸í„°ë¼ì¼„ (ìŠ¤ìœ„ìŠ¤)', 5],
            ['í¬ë¼ì¿ í”„ (í´ë€ë“œ)', 2], ['ë°”ë¥´ìƒ¤ë°” (í´ë€ë“œ)', 2],
            ['ì•„í…Œë„¤ (ê·¸ë¦¬ìŠ¤)', 3], ['ì‚°í† ë¦¬ë‹ˆ (ê·¸ë¦¬ìŠ¤)', 4],
            ['ì´ìŠ¤íƒ„ë¶ˆ (íŠ€ë¥´í‚¤ì˜ˆ)', 2], ['ì¹´íŒŒë„í‚¤ì•„ (íŠ€ë¥´í‚¤ì˜ˆ)', 2], ['ì•ˆíƒˆë¦¬ì•„ (íŠ€ë¥´í‚¤ì˜ˆ)', 2],
            ['ë”ë¸”ë¦° (ì•„ì¼ëœë“œ)', 4], 
            ['ìŠ¤í†¡í™€ë¦„ (ìŠ¤ì›¨ë´)', 4], ['ì˜¤ìŠ¬ë¡œ (ë…¸ë¥´ì›¨ì´)', 5], ['í—¬ì‹±í‚¤ (í•€ë€ë“œ)', 4], ['ì½”íœí•˜ê² (ë´ë§ˆí¬)', 4], ['ë ˆì´ìº¬ë¹„í¬ (ì•„ì´ìŠ¬ë€ë“œ)', 5],
            ['ìê·¸ë ˆë¸Œ (í¬ë¡œì•„í‹°ì•„)', 3], ['ë‘ë¸Œë¡œë¸Œë‹ˆí¬ (í¬ë¡œì•„í‹°ì•„)', 4],
            ['ë‰´ìš• (ë¯¸êµ­)', 5], ['LA (ë¯¸êµ­)', 5], ['ìƒŒí”„ë€ì‹œìŠ¤ì½” (ë¯¸êµ­)', 5], ['ë¼ìŠ¤ë² ì´ê±°ìŠ¤ (ë¯¸êµ­)', 5], ['ì‹œì¹´ê³  (ë¯¸êµ­)', 5], ['ë³´ìŠ¤í„´ (ë¯¸êµ­)', 5], 
            ['ë§ˆì´ì• ë¯¸ (ë¯¸êµ­)', 5], ['ì˜¬ëœë„ (ë¯¸êµ­)', 4], ['ì‹œì• í‹€ (ë¯¸êµ­)', 5], ['ì›Œì‹±í„´DC (ë¯¸êµ­)', 5], ['í˜¸ë†€ë£°ë£¨ (í•˜ì™€ì´)', 5], ['ê´Œ (ë¯¸êµ­)', 4], ['ì‚¬ì´íŒ (ë¯¸êµ­)', 4],
            ['í† ë¡ í†  (ìºë‚˜ë‹¤)', 4], ['ë°´ì¿ ë²„ (ìºë‚˜ë‹¤)', 4], ['ëª¬íŠ¸ë¦¬ì˜¬ (ìºë‚˜ë‹¤)', 4], ['í€˜ë²¡ (ìºë‚˜ë‹¤)', 4],
            ['ì¹¸ì¿¤ (ë©•ì‹œì½”)', 4], ['ë©•ì‹œì½”ì‹œí‹° (ë©•ì‹œì½”)', 3],
            ['ë¦¬ìš°ë°ìë„¤ì´ë£¨ (ë¸Œë¼ì§ˆ)', 3], ['ìƒíŒŒìš¸ë£¨ (ë¸Œë¼ì§ˆ)', 3],
            ['ë¶€ì—ë…¸ìŠ¤ì•„ì´ë ˆìŠ¤ (ì•„ë¥´í—¨í‹°ë‚˜)', 3], 
            ['ì‚°í‹°ì•„ê³  (ì¹ ë ˆ)', 3], ['ë¦¬ë§ˆ (í˜ë£¨)', 2], ['ì¿ ìŠ¤ì½” (í˜ë£¨)', 2], ['ë³´ê³ íƒ€ (ì½œë¡¬ë¹„ì•„)', 2],
            ['ì‹œë“œë‹ˆ (í˜¸ì£¼)', 4], ['ë©œë²„ë¥¸ (í˜¸ì£¼)', 4], ['ë¸Œë¦¬ì¦ˆë²ˆ (í˜¸ì£¼)', 4], ['í¼ìŠ¤ (í˜¸ì£¼)', 4], ['ê³¨ë“œì½”ìŠ¤íŠ¸ (í˜¸ì£¼)', 4],
            ['ì˜¤í´ëœë“œ (ë‰´ì§ˆëœë“œ)', 4], ['í€¸ìŠ¤íƒ€ìš´ (ë‰´ì§ˆëœë“œ)', 4],
            ['ë‘ë°”ì´ (UAE)', 5], ['ì•„ë¶€ë‹¤ë¹„ (UAE)', 5],
            ['ì¹´ì´ë¡œ (ì´ì§‘íŠ¸)', 2], ['ë‹¤í•© (ì´ì§‘íŠ¸)', 1],
            ['ì¼€ì´í”„íƒ€ìš´ (ë‚¨ì•„ê³µ)', 3], ['ìš”í•˜ë„¤ìŠ¤ë²„ê·¸ (ë‚¨ì•„ê³µ)', 3],
            ['ëª°ë””ë¸Œ', 5], ['ëª¨ë¦¬ì…”ìŠ¤', 4], ['ì„¸ì´ì…¸', 5]
        ];

        const CITIES_DB = RAW_CITIES.reduce((acc, [name, tier]) => {
            const id = name.split(' ')[0].toLowerCase().replace(/[^a-z0-9]/g, ''); 
            const uniqueId = acc[id] ? `${id}_${Math.floor(Math.random()*100)}` : id;
            acc[uniqueId] = { name: name, ...PRICE_TIERS[tier] };
            return acc;
        }, {});

        Object.assign(CITIES_DB, {
            'jeju': { name: 'ì œì£¼ë„ (í•œêµ­)', flight: 100000, hostel: 25000, airbnb: 80000, hotel: 150000, food: 20000, coffee: 5000 },
            'busan': { name: 'ë¶€ì‚° (í•œêµ­)', flight: 50000, hostel: 25000, airbnb: 70000, hotel: 120000, food: 15000, coffee: 4500 },
            'seoul': { name: 'ì„œìš¸ (í•œêµ­)', flight: 0, hostel: 30000, airbnb: 90000, hotel: 150000, food: 18000, coffee: 5000 },
            'gangneung': { name: 'ê°•ë¦‰ (í•œêµ­)', flight: 30000, hostel: 25000, airbnb: 80000, hotel: 130000, food: 15000, coffee: 5000 },
        });

        const BANNED_WORDS = ['ê¹¡íŒ¨', 'ë°”ë³´', 'ë©ì²­ì´', 'ì‹œë°œ', 'ë³‘ì‹ ', 'ê°œìƒˆë¼', 'ì§€ë„', 'ë†ˆ', 'ë…„', 'ì£½ì–´', 'ì‚¬ê¸°'];

        const WEEKLY_RANKING_DATA = {
            family: [
                { name: 'ë‚˜íŠ¸ë‘ (ë² íŠ¸ë‚¨)', tag: 'ê°€ì¡±ì—¬í–‰ ì„±ì§€' },
                { name: 'ê´Œ (ë¯¸êµ­)', tag: 'ì‡¼í•‘+íœ´ì–‘ ê¿€ì¡°í•©' },
                { name: 'ì œì£¼ë„ (í•œêµ­)', tag: 'ë´„ê½ƒ ì—¬í–‰ ì‹œì¦Œ' }
            ],
            couple: [
                { name: 'ë°œë¦¬ (ì¸ë„ë„¤ì‹œì•„)', tag: 'ì‹ í˜¼ì—¬í–‰ 1ìœ„' },
                { name: 'êµí†  (ì¼ë³¸)', tag: 'ê°ì„± ê³¨ëª©ê¸¸ ë°ì´íŠ¸' },
                { name: 'íŒŒë¦¬ (í”„ë‘ìŠ¤)', tag: 'ë‚­ë§Œì˜ ë„ì‹œ' }
            ],
            solo: [
                { name: 'ì¹˜ì•™ë§ˆì´ (íƒœêµ­)', tag: 'í•œë‹¬ì‚´ê¸° ì„±ì§€' },
                { name: 'ë„ì¿„ (ì¼ë³¸)', tag: 'í˜¼ë°¥/ë•ì§ˆ ìµœê³ ' },
                { name: 'ë¦¬ìŠ¤ë³¸ (í¬ë¥´íˆ¬ê°ˆ)', tag: 'ìœ ëŸ½ ê°ì„± ë‚­ë‚­' }
            ]
        };

        // ğŸ†• [ë³µêµ¬ ì™„ë£Œ] ì—¬í–‰ ìœ í˜• ë°ì´í„°
        const TRAVEL_TYPES = {
            'emotional': { 
                id: 'emotional',
                title: 'ê°ì„± ì¶©ë§Œ ì—¬í–‰ëŸ¬ ğŸ“¸', 
                desc: 'ë‚¨ëŠ” ê±´ ì‚¬ì§„ë¿!\nì¸ìƒìƒ· ê±´ì§€ëŠ”ê²Œ ì œì¼ ì¤‘ìš”í•´',
                fullDesc: 'ë‹¹ì‹ ì€ ì—¬í–‰ì§€ì—ì„œì˜ "ë¶„ìœ„ê¸°"ê°€ ê°€ì¥ ì¤‘ìš”í•œ ì‚¬ëŒì…ë‹ˆë‹¤.\nìœ ëª…í•œ ëœë“œë§ˆí¬ë³´ë‹¤ëŠ” ê³¨ëª©ê¸¸ì˜ ì˜ˆìœ ì¹´í˜ê°€ ë” ì¢‹ê³ ,\në§›ë³´ë‹¤ëŠ” í”Œë ˆì´íŒ…ì´ ì˜ˆìœ ì‹ë‹¹ì„ ì„ í˜¸í•©ë‹ˆë‹¤.\nì‚¬ì§„ì²©ì— 3000ì¥ì˜ ì‚¬ì§„ì´ ìŒ“ì—¬ì•¼ ì—¬í–‰ ë!',
                icon: 'ğŸ“¸',
                color: 'text-pink-500',
                bg: 'bg-pink-50',
                borderColor: 'border-pink-200',
                best: 'foodie', 
                worst: 'activity', 
                bestText: 'ì©ì©ë°•ì‚¬ ë¨¹ë°©ëŸ¬',
                worstText: 'ì—ë„ˆìì´ì € ì•¡í‹°ë¹„í‹°ëŸ¬',
                percent: 35
            },
            'activity': { 
                id: 'activity',
                title: 'ì—ë„ˆìì´ì € ì•¡í‹°ë¹„í‹°ëŸ¬ ğŸ„â€â™‚ï¸', 
                desc: 'ê°€ë§Œíˆ ìˆìœ¼ë©´ ëª¸ì‚´ ë‚˜!\nì„œí•‘, ë“±ì‚°, ë‹¤ì´ë¹™ ê³ ê³ !', 
                fullDesc: 'ë‹¹ì‹ ì—ê²Œ íœ´ì‹ì´ë€ "ìƒˆë¡œìš´ ë„ì „"ì„ í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.\ní•´ë³€ì— ëˆ„ì›ŒìˆëŠ” ê²ƒë³´ë‹¤ëŠ” íŒŒë„ë¥¼ íƒ€ì•¼ í•˜ê³ ,\ní˜¸í…”ì— ìˆëŠ” ê²ƒë³´ë‹¤ëŠ” ì•¼ì‹œì¥ì„ ë›°ì–´ë‹¤ë…€ì•¼ í•©ë‹ˆë‹¤.\nì²´ë ¥ì´ êµ­ë ¥ì¸ ë‹¹ì‹ ì€ ì§„ì •í•œ ëª¨í—˜ê°€!',
                icon: 'ğŸ„â€â™‚ï¸',
                color: 'text-green-600',
                bg: 'bg-green-50',
                borderColor: 'border-green-200',
                best: 'healing', 
                worst: 'emotional',
                bestText: 'ì¹¨ëŒ€ì™€ í•œëª¸ íë§ëŸ¬',
                worstText: 'ê°ì„± ì¶©ë§Œ ì—¬í–‰ëŸ¬',
                percent: 20
            },
            'healing': { 
                id: 'healing',
                title: 'ì¹¨ëŒ€ì™€ í•œëª¸ íë§ëŸ¬ ğŸ›Œ', 
                desc: 'ê´€ê´‘ì§€? ê·€ì°®ì•„...\ní˜¸ìº‰ìŠ¤í•˜ë©° ë©ë•Œë¦¬ëŠ”ê²Œ ìµœê³ ì•¼', 
                fullDesc: 'ë‹¹ì‹ ì€ ì¼ìƒì— ì§€ì³ ì§„ì •í•œ íœ´ì‹ì„ ì°¾ì•„ ë– ë‚¬ìŠµë‹ˆë‹¤.\nì•ŒëŒ ì—†ì´ ëŠ¦ì  ìê¸°, ìˆ˜ì˜ì¥ì—ì„œ ì¹µí…Œì¼ ë§ˆì‹œê¸°,\në§ˆì‚¬ì§€ ë°›ê¸°ê°€ ì—¬í–‰ ê³„íšì˜ ì „ë¶€ì…ë‹ˆë‹¤.\në¬´ê³„íšì´ ìµœê³ ì˜ ê³„íšì´ë¼ê³  ë¯¿ëŠ” ë‹¹ì‹ !',
                icon: 'ğŸ›Œ',
                color: 'text-blue-500',
                bg: 'bg-blue-50',
                borderColor: 'border-blue-200',
                best: 'activity', 
                worst: 'foodie', 
                bestText: 'ì—ë„ˆìì´ì € ì•¡í‹°ë¹„í‹°ëŸ¬',
                worstText: 'ì©ì©ë°•ì‚¬ ë¨¹ë°©ëŸ¬',
                percent: 25
            },
            'foodie': { 
                id: 'foodie',
                title: 'ì©ì©ë°•ì‚¬ ë¨¹ë°©ëŸ¬ ğŸ–', 
                desc: 'ì—¬í–‰ = ë¨¹ëŠ” ê²ƒ.\në§›ì§‘ ì§€ë„ë¶€í„° ì¼œëŠ” ë‹¹ì‹ !', 
                fullDesc: 'ë‹¹ì‹ ì—ê²Œ ì—¬í–‰ì§€ëŠ” "ìƒˆë¡œìš´ ë§›"ì´ ìˆëŠ” ê³³ì…ë‹ˆë‹¤.\ní•˜ë£¨ 5ë¼ëŠ” ê¸°ë³¸ì´ë©°, í˜„ì§€ì¸ ë§›ì§‘ì„ ì°¾ê¸° ìœ„í•´\nêµ¬ê¸€ë§µ ë¦¬ë·°ë¥¼ 10í˜ì´ì§€ê¹Œì§€ ì •ë…í•©ë‹ˆë‹¤.\në§›ì—†ëŠ” ê±¸ ë¨¹ìœ¼ë©´ í™”ê°€ ë‚˜ëŠ” ë¯¸ì‹ê°€!',
                icon: 'ğŸ–',
                color: 'text-orange-500',
                bg: 'bg-orange-50',
                borderColor: 'border-orange-200',
                best: 'emotional', 
                worst: 'healing', 
                bestText: 'ê°ì„± ì¶©ë§Œ ì—¬í–‰ëŸ¬',
                worstText: 'ì¹¨ëŒ€ì™€ í•œëª¸ íë§ëŸ¬',
                percent: 20
            },
        };

        // --- ì»´í¬ë„ŒíŠ¸ ì •ì˜ ---

        function RankingBox({ icon, title, data }) {
            return (
                <div className="bg-white p-5 rounded-[20px] border border-[#F0E6D8] soft-shadow hover:border-orange-200 transition duration-300">
                    <h3 className="text-md mb-4 flex items-center gap-2 text-[#555] font-medium border-b border-[#F5F5F5] pb-3">{icon} {title}</h3>
                    <ol className="space-y-3">
                        {data.map((item, idx) => (
                            <li key={idx} className="flex justify-between items-center group cursor-pointer"><div className="flex items-center gap-3"><span className={`flex items-center justify-center w-5 h-5 rounded-full text-[10px] font-bold text-white ${idx === 0 ? 'bg-orange-400' : 'bg-[#DDD]'}`}>{idx + 1}</span><span className="text-[#666] group-hover:text-orange-500 transition">{item.name}</span></div><span className="text-[10px] text-[#BBB] bg-[#F9F9F9] px-2 py-0.5 rounded-md">{item.tag}</span></li>
                        ))}
                    </ol>
                </div>
            );
        }

        function HomeMenu({ setPage }) {
            const menus = [
                { id: 'calc', title: 'ì—¬í–‰ ê²¬ì  ê³„ì‚°ê¸°', sub: 'ì–¼ë§ˆë‚˜ í•„ìš”í• ê¹Œ?', icon: <Calculator className="w-7 h-7" /> },
                { id: 'budget', title: 'ì˜ˆì‚° ë§ì¶¤ ì—¬í–‰ì§€', sub: 'ë‚´ ëˆìœ¼ë¡œ ì–´ë””ê¹Œì§€?', icon: <Sparkles className="w-7 h-7" /> },
                { id: 'mbti', title: 'ì—¬í–‰ ì„±í–¥ í…ŒìŠ¤íŠ¸', sub: 'ë‚˜ë‘ ì°°ë–¡ì¸ ê³³ì€?', icon: <User className="w-7 h-7" /> },
                { id: 'search', title: 'ìµœì €ê°€ ê²€ìƒ‰', sub: 'íŠ¹ê°€ ì¤ì¤í•˜ê¸°', icon: <Search className="w-7 h-7" /> },
            ];
            return <div className="flex flex-col gap-4 h-full justify-center px-6"><div className="text-center mb-6"><h2 className="text-2xl text-[#444] mb-2">ì–´ë””ë¡œ ë– ë‚˜ì‹œë‚˜ìš”? âœˆï¸</h2><p className="text-[#999] font-light">í•„ìš”í•œ ê¸°ëŠ¥ì„ ì„ íƒí•´ë³´ì„¸ìš”</p></div><div className="grid grid-cols-1 md:grid-cols-2 gap-4">{menus.map((menu) => (<button key={menu.id} onClick={() => setPage(menu.id)} className="bg-[#FAFAFA] p-6 rounded-[24px] border border-transparent hover:border-orange-200 hover:bg-orange-50/30 flex flex-col items-center justify-center gap-3 transition-all duration-300 group btn-press"><div className="bg-white p-4 rounded-2xl shadow-sm text-[#888] group-hover:text-orange-500 group-hover:scale-110 transition duration-300">{menu.icon}</div><div className="text-center"><h3 className="text-lg text-[#555] mb-1">{menu.title}</h3><p className="text-xs text-[#AAA]">{menu.sub}</p></div></button>))}</div></div>;
        }

        function SearchableCitySelect({ value, onChange }) {
            const [isOpen, setIsOpen] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');
            const wrapperRef = useRef(null);
            
            const cities = useMemo(() => Object.keys(CITIES_DB).map(key => ({ key, ...CITIES_DB[key] })), []);
            const filteredCities = cities.filter(city => city.name.toLowerCase().includes(searchTerm.toLowerCase()));
            const selectedCityName = CITIES_DB[value]?.name || 'ë„ì‹œ ì„ íƒ';

            useEffect(() => {
                function handleClickOutside(event) { if (wrapperRef.current && !wrapperRef.current.contains(event.target)) { setIsOpen(false); } }
                document.addEventListener("mousedown", handleClickOutside);
                return () => document.removeEventListener("mousedown", handleClickOutside);
            }, [wrapperRef]);

            return (
                <div className="relative" ref={wrapperRef}>
                    <div onClick={() => setIsOpen(!isOpen)} className="w-full p-3 rounded-xl border border-[#EEE] bg-[#FAFAFA] cursor-pointer flex justify-between items-center hover:border-orange-200 transition">
                        <span className="text-[#555]">{selectedCityName}</span>
                        <ChevronRight className={`w-4 h-4 text-[#AAA] transition-transform ${isOpen ? 'rotate-90' : ''}`} />
                    </div>
                    {isOpen && (
                        <div className="absolute z-50 w-full mt-2 bg-white rounded-xl border border-[#F0E6D8] shadow-lg max-h-60 overflow-hidden flex flex-col">
                            <div className="p-2 border-b border-[#F5F5F5] flex items-center gap-2">
                                <Search className="w-4 h-4 text-[#AAA]" />
                                <input type="text" placeholder="ë„ì‹œ ê²€ìƒ‰ (ì˜ˆ: í”„ë¼í•˜, ë‹¤ë‚­)" className="w-full text-sm outline-none text-[#555]" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} autoFocus />
                            </div>
                            <div className="overflow-y-auto flex-1">
                                {filteredCities.length > 0 ? filteredCities.map((city) => (
                                    <div key={city.key} onClick={() => { onChange(city.key); setIsOpen(false); setSearchTerm(''); }} className={`p-3 text-sm cursor-pointer hover:bg-orange-50 transition ${value === city.key ? 'bg-orange-50 text-orange-500 font-bold' : 'text-[#666]'}`}>
                                        {city.name}
                                    </div>
                                )) : <div className="p-4 text-center text-xs text-[#AAA]">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì–´ìš” ğŸ¥²</div>}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        function CostCalculator() {
            const [city, setCity] = useState('bali');
            const [days, setDays] = useState(30);
            const [style, setStyle] = useState(1);
            const [accom, setAccom] = useState('hostel');
            const [result, setResult] = useState(null);
            
            const calculate = () => {
                const data = CITIES_DB[city];
                const flightCost = data.flight;
                const stayUnitCost = data[accom];
                const stayTotal = stayUnitCost * days;
                const foodUnitCost = data.food * 3 + data.coffee; 
                const foodTotal = foodUnitCost * days * style;
                const etcTotal = 10000 * days;
                
                const total = flightCost + stayTotal + foodTotal + etcTotal;
                
                setResult({ 
                    total, 
                    breakdown: { flight: flightCost, stay: stayTotal, food: foodTotal, etc: etcTotal },
                    details: { 
                        stayUnit: stayUnitCost, 
                        foodUnit: foodUnitCost,
                        styleLabel: style === 0.8 ? 'ì ˆì•½í˜•' : style === 1.5 ? 'í”Œë ‰ìŠ¤' : 'ë³´í†µ'
                    }
                });
            };

            return (
                <div className="max-w-md mx-auto mt-2">
                    <h2 className="text-xl mb-6 text-center text-[#555]">ğŸ§® ì—¬í–‰ ê²¬ì  ê³„ì‚°ê¸°</h2>
                    {!result ? (
                        <div className="space-y-6 px-4">
                            <div className="space-y-2"><label className="text-sm text-[#888]">ë– ë‚  ë„ì‹œ (ê²€ìƒ‰ ê°€ëŠ¥!)</label><SearchableCitySelect value={city} onChange={setCity} /></div>
                            <div className="space-y-2"><label className="text-sm text-[#888]">ì—¬í–‰ ê¸°ê°„ (ì¼)</label><input type="number" className="w-full p-3 rounded-xl border border-[#EEE] bg-[#FAFAFA] text-center" value={days} onChange={(e) => setDays(Number(e.target.value))} /></div>
                            <div className="space-y-2"><label className="text-sm text-[#888]">ì†Œë¹„ ìŠ¤íƒ€ì¼</label><div className="flex gap-2 p-1 bg-[#FAFAFA] rounded-xl border border-[#EEE]">{[ { l: 'ì•Œëœ°í•˜ê²Œ', v: 0.8 }, { l: 'í‰ë²”í•˜ê²Œ', v: 1 }, { l: 'ì—¬ìœ ë¡­ê²Œ', v: 1.5 } ].map((opt) => ( <button key={opt.l} onClick={() => setStyle(opt.v)} className={`flex-1 py-2 rounded-lg text-sm transition ${style === opt.v ? 'bg-white shadow-sm text-orange-500 font-medium' : 'text-[#AAA]'}`}>{opt.l}</button>))}</div></div>
                            <div className="space-y-2"><label className="text-sm text-[#888]">ìˆ™ì†Œ ìœ í˜•</label><select className="w-full p-3 rounded-xl border border-[#EEE] bg-[#FAFAFA]" value={accom} onChange={(e) => setAccom(e.target.value)}><option value="hostel">ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ (ì €ë ´)</option><option value="airbnb">ì—ì–´ë¹„ì•¤ë¹„ (ê°ì„±)</option><option value="hotel">í˜¸í…”/ë¦¬ì¡°íŠ¸ (í¸ì•ˆ)</option></select></div>
                            <button onClick={calculate} className="w-full bg-[#444] text-white py-4 rounded-xl text-lg hover:bg-[#333] transition shadow-md btn-press mt-4">ê³„ì‚°í•˜ê¸°</button>
                        </div>
                    ) : (
                        <div className="bg-[#FAFAFA] p-6 rounded-3xl border border-[#EEE] text-center animate-pop">
                            <h3 className="text-lg text-[#666] mb-2">{CITIES_DB[city].name} {days}ì¼ ì‚´ê¸°</h3>
                            <div className="text-3xl text-[#444] mt-2 font-bold">{result.total.toLocaleString()}ì›</div>
                            <div className="text-xs text-[#AAA] mb-6">ì˜ˆìƒ ì´ ë¹„ìš©</div>
                            
                            <div className="text-left space-y-3 bg-white p-4 rounded-2xl border border-[#EEE] text-sm text-[#666] mb-4">
                                <div className="flex justify-between">
                                    <span>ğŸ›« í•­ê³µê¶Œ (í‰ê· )</span>
                                    <span className="font-bold">{result.breakdown.flight.toLocaleString()}ì›</span>
                                </div>
                                <div className="flex justify-between items-center">
                                    <div>
                                        <span>ğŸ  ìˆ™ë°•ë¹„</span>
                                        <div className="text-[10px] text-[#AAA]">{result.details.stayUnit.toLocaleString()}ì› Ã— {days}ë°•</div>
                                    </div>
                                    <span className="font-bold">{result.breakdown.stay.toLocaleString()}ì›</span>
                                </div>
                                <div className="flex justify-between items-center">
                                    <div>
                                        <span>ğŸ” ì‹ë¹„/ì»¤í”¼ ({result.details.styleLabel})</span>
                                        <div className="text-[10px] text-[#AAA]">í•˜ë£¨ ì•½ {(result.details.foodUnit * (style === 0.8 ? 0.8 : style === 1.5 ? 1.5 : 1)).toLocaleString()}ì›</div>
                                    </div>
                                    <span className="font-bold">{result.breakdown.food.toLocaleString()}ì›</span>
                                </div>
                            </div>

                            <button onClick={() => setResult(null)} className="w-full mt-2 bg-white border border-[#DDD] text-[#666] py-3 rounded-xl hover:bg-[#F5F5F5] transition text-sm">ë‹¤ì‹œ ê³„ì‚°í•˜ê¸°</button>
                        </div>
                    )}
                </div>
            );
        }

        function BudgetRecommender() {
             const [budget, setBudget] = useState(2000000);
             const [selectedCity, setSelectedCity] = useState(null);

             const cityCosts = useMemo(() => {
                 return Object.keys(CITIES_DB).map(key => {
                     const city = CITIES_DB[key];
                     const estimatedCost = city.flight + (city.airbnb * 7) + (city.food * 14);
                     return {
                         key,
                         ...city,
                         cost: estimatedCost,
                         isPossible: estimatedCost <= budget
                     };
                 });
             }, [budget]);

             const sortedCities = useMemo(() => {
                 return cityCosts.sort((a, b) => {
                     if (a.isPossible === b.isPossible) return a.cost - b.cost;
                     return a.isPossible ? -1 : 1;
                 }).slice(0, 50);
             }, [cityCosts]);

             const getCityRecommendations = (cityName, cityData) => {
                 const name = cityName.split(' (')[0];
                 const hostelPrice = cityData.hostel;
                 const hotelPrice = cityData.hotel;
                 const airbnbPrice = cityData.airbnb;

                 return {
                     hotels: [
                        { name: `${name} ê·¸ëœë“œ í˜¸í…”`, price: hotelPrice * 1.2 },
                        { name: `${name} ì‹œí‹° í˜¸ìŠ¤í…”`, price: hostelPrice }, 
                        { name: `ì—ì–´ë¹„ì•¤ë¹„ - ${name} ì„¼í„°`, price: airbnbPrice }
                     ],
                     cafes: [`ì¹´í˜ ${name}`, `ìŠ¤íƒ€ë²…ìŠ¤ ${name}ì `, `${name} ë¡œìŠ¤í„°ë¦¬`],
                     spots: [`${name} ì¤‘ì•™ ê³µì›`, `${name} ì•¼ì‹œì¥`, `${name} ì˜¬ë“œíƒ€ìš´`]
                 };
             };

             return (
                <div className="max-w-md mx-auto mt-4 px-4 relative">
                    {selectedCity && (
                        <div className="absolute inset-0 z-50 flex items-center justify-center p-4">
                            <div className="absolute inset-0 bg-black/50 rounded-[24px]" onClick={() => setSelectedCity(null)}></div>
                            <div className="bg-white w-full max-w-sm rounded-2xl p-6 relative z-10 shadow-xl animate-pop max-h-[80vh] overflow-y-auto flex flex-col">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-xl font-bold text-gray-800">{selectedCity.name}</h3>
                                    <button onClick={() => setSelectedCity(null)} className="text-gray-400 hover:text-gray-600"><X className="w-6 h-6" /></button>
                                </div>
                                <p className="text-xs text-center text-orange-500 mb-6 font-bold">âœ¨ ì´ ë„ì‹œì˜ ì¶”ì²œ í•«í”Œ & ì˜ˆìƒ ê°€ê²©</p>
                                
                                <div className="space-y-6 flex-1 overflow-y-auto">
                                    <div>
                                        <h4 className="flex items-center gap-2 text-sm font-bold text-gray-700 mb-3 border-b pb-2"><Hotel className="w-4 h-4 text-pink-500" /> ì¶”ì²œ ìˆ™ì†Œ (1ë°• ê¸°ì¤€)</h4>
                                        <ul className="space-y-3">
                                            {getCityRecommendations(selectedCity.name, selectedCity).hotels.map((item, idx) => (
                                                <li key={idx} className="flex justify-between items-center text-sm text-gray-600 bg-gray-50 p-3 rounded-lg">
                                                    <div className="flex items-center gap-2">
                                                        <span className="text-[10px] bg-pink-100 text-pink-500 px-1.5 py-0.5 rounded font-bold">HOT</span>
                                                        <span className="font-medium text-gray-700">{item.name}</span>
                                                    </div>
                                                    <span className="text-xs font-bold text-gray-500">ì•½ {item.price.toLocaleString()}ì›</span>
                                                </li>
                                            ))}
                                        </ul>
                                    </div>
                                    <div><h4 className="flex items-center gap-2 text-sm font-bold text-gray-700 mb-3 border-b pb-2"><Coffee className="w-4 h-4 text-brown-500" /> ì¸ê¸° ì¹´í˜</h4><ul className="space-y-2">{getCityRecommendations(selectedCity.name, selectedCity).cafes.map((item, idx) => (<li key={idx} className="text-sm text-gray-600 bg-gray-50 p-2 rounded-lg flex items-center gap-2"><span className="text-xs bg-orange-100 text-orange-500 px-1.5 rounded">â˜•</span> {item}</li>))}</ul></div>
                                    <div><h4 className="flex items-center gap-2 text-sm font-bold text-gray-700 mb-3 border-b pb-2"><Camera className="w-4 h-4 text-blue-500" /> ê°€ë³¼ë§Œí•œ ê³³</h4><ul className="space-y-2">{getCityRecommendations(selectedCity.name, selectedCity).spots.map((item, idx) => (<li key={idx} className="text-sm text-gray-600 bg-gray-50 p-2 rounded-lg flex items-center gap-2"><span className="text-xs bg-blue-100 text-blue-500 px-1.5 rounded">ğŸ“</span> {item}</li>))}</ul></div>
                                </div>
                                <button onClick={() => setSelectedCity(null)} className="w-full mt-6 bg-gray-100 text-gray-600 py-3 rounded-xl font-bold hover:bg-gray-200 transition">ë‹«ê¸°</button>
                            </div>
                        </div>
                    )}
                    <h2 className="text-xl mb-6 text-center text-[#555]">ğŸ’° ì˜ˆì‚° ë§ì¶¤ ì¶”ì²œ</h2>
                    <div className="bg-[#FAFAFA] p-6 rounded-3xl border border-[#EEE] text-center mb-6"><div className="text-2xl text-orange-500 font-bold mb-4">{budget.toLocaleString()}ì›</div><input type="range" min="500000" max="5000000" step="100000" value={budget} onChange={(e) => setBudget(Number(e.target.value))} className="w-full accent-orange-400 h-2 bg-[#E0E0E0] rounded-lg appearance-none cursor-pointer" /></div>
                    
                    <div className="space-y-3 pb-10 h-[400px] overflow-y-auto scrollbar-hide">
                        {sortedCities.map(city => (
                            <div 
                                key={city.key} 
                                onClick={() => setSelectedCity(city)}
                                className={`flex justify-between items-center p-4 rounded-2xl cursor-pointer border transition gap-4 group ${city.isPossible ? 'bg-white border-[#EEE] hover:border-green-300' : 'bg-gray-50 border-gray-100 opacity-70 hover:opacity-100'}`}
                            >
                                <div className="flex flex-col text-left min-w-0">
                                    <span className={`font-medium truncate ${city.isPossible ? 'text-gray-700 group-hover:text-green-600' : 'text-gray-400'}`}>{city.name}</span>
                                    {!city.isPossible && <span className="text-[10px] text-red-400 truncate">ì•½ {(city.cost - budget).toLocaleString()}ì› ë¶€ì¡± ğŸ¥²</span>}
                                </div>
                                
                                <span className={`text-xs px-3 py-1 rounded-full font-bold whitespace-nowrap flex-shrink-0 ${city.isPossible ? 'bg-green-100 text-green-600' : 'bg-red-50 text-red-400'}`}>
                                    {city.isPossible ? 'ê°€ëŠ¥ ğŸ™†â€â™‚ï¸' : 'ë¶ˆê°€ëŠ¥ ğŸ™…â€â™‚ï¸'}
                                </span>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // ğŸ†• 4. ë³µêµ¬ëœ ì„±í–¥ í…ŒìŠ¤íŠ¸ ì»´í¬ë„ŒíŠ¸
        function MbtiAnalyzer() {
            const [step, setStep] = useState(0); 
            const [answers, setAnswers] = useState({});
            const startTest = () => setStep(1);
            const handleAnswer = (val) => { 
                const next = { ...answers, [`q${step}`]: val }; 
                setAnswers(next); 
                if (step < 3) setStep(step + 1); 
                else setStep(4); 
            };
            
            // ê²°ê³¼ ê³„ì‚° ë¡œì§
            const getResult = () => {
                const { q1, q2, q3 } = answers;
                if (q1 === 'A' && q3 === 'A') return 'emotional';
                if (q1 === 'B' && q2 === 'A') return 'activity';
                if (q2 === 'B' && q3 === 'B') return 'healing';
                return 'foodie';
            };
            
            const resultData = TRAVEL_TYPES[getResult()];
            const bestMatch = TRAVEL_TYPES[resultData.best];
            const worstMatch = TRAVEL_TYPES[resultData.worst];

            const handleShare = () => { 
                const shareText = `[ë‚˜ì˜ ì—¬í–‰ ì„¸í¬ í…ŒìŠ¤íŠ¸]\në‚˜ëŠ” "${resultData.title}" ìœ í˜•ì´ë˜!\n\n${resultData.desc}\n\në„ˆë„ í•œë²ˆ í•´ë´! ğŸ‘‰ https://yeoja.travel`;
                navigator.clipboard.writeText(shareText).then(() => alert("ë³µì‚¬ ì™„ë£Œ!")); 
            };
            
            // ë­í‚¹ ë°” ì •ë ¬
            const sortedRanking = Object.values(TRAVEL_TYPES).sort((a, b) => b.percent - a.percent);

            if (step === 0) {
                return (
                    <div className="text-center py-10">
                        <div className="text-6xl mb-6 animate-bounce">ğŸ§ </div>
                        <h2 className="text-2xl text-[#444] mb-3">ë‚˜ì˜ ì—¬í–‰ ì„¸í¬ ì°¾ê¸°</h2>
                        <p className="mb-10 text-[#999] text-sm">30ì´ˆ ë§Œì— ì•Œì•„ë³´ëŠ”<br/>ë‚˜ë§Œì˜ ì—¬í–‰ ìŠ¤íƒ€ì¼</p>
                        <button onClick={startTest} className="w-full bg-orange-400 text-white py-4 rounded-2xl text-lg font-bold shadow-md btn-press">
                            í…ŒìŠ¤íŠ¸ ì‹œì‘í•˜ê¸°
                        </button>
                    </div>
                );
            }

            if (step >= 1 && step <= 3) {
                return (
                    <div className="animate-fade-in px-2">
                        <div className="flex justify-center mb-8">
                            <span className="bg-orange-100 text-orange-500 px-4 py-1 rounded-full text-sm font-medium">Question {step}</span>
                        </div>
                        <h3 className="text-xl mb-10 leading-relaxed text-[#555] text-center">
                            {step === 1 && "ì—¬í–‰ì§€ì— ë„ì°©í–ˆë‹¤! \nê°€ì¥ ë¨¼ì € í•  ì¼ì€?"}
                            {step === 2 && "ì—¬í–‰ ê³„íš, \nì–´ë–»ê²Œ ì§œê³  ì™”ì–´?"}
                            {step === 3 && "ìˆ™ì†Œ ê³ ë¥¼ ë•Œ \në­ê°€ ì œì¼ ì¤‘ìš”í•´?"}
                        </h3>
                        <div className="space-y-4">
                            <button onClick={() => handleAnswer('A')} className="w-full p-5 bg-[#FAFAFA] border border-[#EEE] rounded-2xl hover:bg-orange-50 hover:border-orange-200 transition text-left text-[#666] btn-press">
                                {step === 1 && "ğŸ“¸ ì¼ë‹¨ ëœë“œë§ˆí¬ ì¸ì¦ìƒ·ë¶€í„° ì°ì–´ì•¼ì§€!"}
                                {step === 2 && "ğŸ“‘ ì—‘ì…€ë¡œ ë¶„ ë‹¨ìœ„ ê³„íší‘œ ì§œì™”ìŒ (J)"}
                                {step === 3 && "âœ¨ ë¬´ì¡°ê±´ ê°ì„±! ì¸í…Œë¦¬ì–´ ì˜ˆìœ ê³³"}
                            </button>
                            <button onClick={() => handleAnswer('B')} className="w-full p-5 bg-[#FAFAFA] border border-[#EEE] rounded-2xl hover:bg-orange-50 hover:border-orange-200 transition text-left text-[#666] btn-press">
                                {step === 1 && "ğŸ¤¤ ê¸ˆê°•ì‚°ë„ ì‹í›„ê²½! ë§›ì§‘ë¶€í„° ì°¾ëŠ”ë‹¤."}
                                {step === 2 && "âœˆï¸ ë¹„í–‰ê¸°í‘œë§Œ ëŠì—ˆì–´. ê°€ì„œ ìƒê°í•˜ì (P)"}
                                {step === 3 && "ğŸ›Œ ì ë§Œ ìë©´ ë¨! ìœ„ì¹˜ë‘ ê°€ì„±ë¹„ê°€ ìµœê³ "}
                            </button>
                        </div>
                    </div>
                );
            }
            
            if (step === 4) {
                return (
                    <div className="animate-fade-in pb-10">
                        <div className={`bg-white p-6 rounded-[30px] shadow-lg border-4 ${resultData.borderColor} text-center mb-8 relative overflow-hidden`}>
                            <div className={`absolute top-0 left-0 w-full h-4 ${resultData.bg}`}></div>
                            <div className="text-sm text-gray-400 mb-4 mt-2">ë‹¹ì‹ ì˜ ì—¬í–‰ ì„¸í¬ëŠ”...</div>
                            <div className="text-7xl mb-4 animate-bounce">{resultData.icon}</div>
                            <h2 className={`text-2xl font-bold mb-4 ${resultData.color}`}>{resultData.title}</h2>
                            <p className="text-gray-600 mb-6 text-sm whitespace-pre-line leading-loose bg-gray-50 p-4 rounded-xl">
                                {resultData.fullDesc}
                            </p>
                            <div className="flex gap-2">
                                <button onClick={() => {setStep(0); setAnswers({});}} className="flex-1 bg-gray-100 text-gray-500 py-3 rounded-xl hover:bg-gray-200 transition text-sm">ë‹¤ì‹œí•˜ê¸°</button>
                                <button onClick={handleShare} className={`flex-1 text-white py-3 rounded-xl transition shadow-md text-sm flex items-center justify-center gap-2 ${resultData.color.replace('text', 'bg')}`}>
                                    <Share2 className="w-4 h-4" /> ê²°ê³¼ ê³µìœ 
                                </button>
                            </div>
                        </div>
                        <div className="grid grid-cols-2 gap-4 mb-8">
                            <div className="bg-blue-50 p-4 rounded-2xl border border-blue-100 text-center">
                                <div className="text-xs text-blue-400 mb-1 font-bold">í™˜ìƒì˜ ì§ê¿ ğŸ˜</div>
                                <div className="text-3xl mb-1">{bestMatch.icon}</div>
                                <div className="text-xs text-gray-600 font-bold">{bestMatch.bestText}</div>
                            </div>
                            <div className="bg-red-50 p-4 rounded-2xl border border-red-100 text-center">
                                <div className="text-xs text-red-400 mb-1 font-bold">í™˜ì¥ì˜ ì¼€ë¯¸ ğŸ˜±</div>
                                <div className="text-3xl mb-1">{worstMatch.icon}</div>
                                <div className="text-xs text-gray-600 font-bold">{worstMatch.worstText}</div>
                            </div>
                        </div>
                        <div className="bg-white p-5 rounded-2xl border border-[#EEE]">
                            <div className="flex items-center gap-2 mb-4 border-b border-gray-100 pb-2">
                                <Trophy className="w-5 h-5 text-yellow-500" />
                                <span className="font-bold text-gray-700">ì‹¤ì‹œê°„ ìœ í˜• ë­í‚¹</span>
                            </div>
                            <div className="space-y-4">
                                {sortedRanking.map((type, idx) => (
                                    <div key={type.id} className="relative">
                                        <div className="flex justify-between items-end mb-1 text-xs">
                                            <span className="font-bold text-gray-600 flex items-center gap-1">
                                                <span className={`w-4 h-4 rounded-full flex items-center justify-center text-[9px] text-white ${idx === 0 ? 'bg-yellow-400' : 'bg-gray-300'}`}>{idx + 1}</span>
                                                {type.title.split(' ')[0]} {type.title.split(' ')[1]}
                                            </span>
                                            <span className="text-gray-400">{type.percent}%</span>
                                        </div>
                                        <div className="w-full h-2 bg-gray-100 rounded-full overflow-hidden">
                                            <div 
                                                className={`h-full rounded-full ${type.bg.replace('bg-', 'bg-')}`} 
                                                style={{ 
                                                    width: `${type.percent}%`, 
                                                    backgroundColor: type.color.includes('pink') ? '#ec4899' : type.color.includes('green') ? '#16a34a' : type.color.includes('blue') ? '#3b82f6' : '#f97316' 
                                                }}
                                            ></div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }
            return null;
        }

        function RealTimeSearch() {
            const AGENCIES = {
                'agoda': { name: 'ì•„ê³ ë‹¤', color: 'bg-blue-600', hover: 'hover:bg-blue-700' },
                'skyscanner': { name: 'ìŠ¤ì¹´ì´ìŠ¤ìºë„ˆ', color: 'bg-sky-500', hover: 'hover:bg-sky-600' },
                'trip': { name: 'íŠ¸ë¦½ë‹·ì»´', color: 'bg-blue-800', hover: 'hover:bg-blue-900' },
                'myrealtrip': { name: 'ë§ˆì´ë¦¬ì–¼íŠ¸ë¦½', color: 'bg-indigo-500', hover: 'hover:bg-indigo-600' }
            };
            const [searchTerm, setSearchTerm] = useState('');
            const [selectedCityForAgency, setSelectedCityForAgency] = useState(null);
            const searchResults = useMemo(() => { if (!searchTerm) return []; return Object.values(CITIES_DB).filter(city => city.name.includes(searchTerm)); }, [searchTerm]);
            const handleAgencyClick = (agencyKey) => {
                if (!selectedCityForAgency) return;
                const query = selectedCityForAgency.name.split(' (')[0]; 
                const cid = "123456"; 
                let finalUrl = "";
                if (agencyKey === 'agoda') finalUrl = `https://www.agoda.com/search?cid=${cid}&text=${encodeURIComponent(query)}`;
                else if (agencyKey === 'skyscanner') finalUrl = `https://www.skyscanner.co.kr/transport/flights/icn?destination=${encodeURIComponent(query)}`; 
                else if (agencyKey === 'trip') finalUrl = `https://kr.trip.com/hotels/list?cityname=${encodeURIComponent(query)}`;
                else if (agencyKey === 'myrealtrip') finalUrl = `https://www.myrealtrip.com/search?q=${encodeURIComponent(query)}`;
                window.open(finalUrl, '_blank');
            };

            return (
                <div className="max-w-md mx-auto mt-2 h-full px-4 relative">
                    <h2 className="text-xl mb-6 text-center text-[#555]">ğŸ”¥ ìµœì €ê°€ ê²€ìƒ‰</h2>
                    {selectedCityForAgency && (
                        <div className="absolute inset-0 z-50 flex items-center justify-center p-4">
                            <div className="absolute inset-0 bg-black/50 rounded-[24px]" onClick={() => setSelectedCityForAgency(null)}></div>
                            <div className="bg-white w-full max-w-sm rounded-2xl p-6 relative z-10 shadow-xl animate-pop">
                                <button onClick={() => setSelectedCityForAgency(null)} className="absolute top-4 right-4 text-gray-400 hover:text-gray-600"><X className="w-5 h-5" /></button>
                                <h3 className="text-lg font-bold text-center text-gray-800 mb-1">{selectedCityForAgency.name}</h3><p className="text-xs text-center text-gray-500 mb-6">ì–´ë””ì„œ ê°€ê²©ì„ ë¹„êµí•´ë³¼ê¹Œìš”?</p>
                                <div className="space-y-3">{Object.entries(AGENCIES).map(([key, agency]) => (<button key={key} onClick={() => handleAgencyClick(key)} className={`w-full py-4 rounded-xl text-white font-bold shadow-md transition flex items-center justify-between px-6 ${agency.color} ${agency.hover}`}><span className="flex items-center gap-2"><Plane className="w-4 h-4" /> {agency.name}</span><ChevronRight className="w-5 h-5 opacity-70" /></button>))}</div>
                            </div>
                        </div>
                    )}
                    <div className="relative mb-6"><input type="text" placeholder="ë„ì‹œ ì´ë¦„ì„ ê²€ìƒ‰í•´ë³´ì„¸ìš” (ì˜ˆ: ì˜¤ì‚¬ì¹´)" className="w-full p-4 pl-12 rounded-2xl border border-[#EEE] bg-white shadow-sm outline-none focus:border-orange-400 transition" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} /><Search className="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" /></div>
                    <div className="space-y-4 overflow-y-auto h-[400px] scrollbar-hide pb-10">
                        {searchTerm ? (searchResults.length > 0 ? (searchResults.map((city, idx) => (<div key={idx} onClick={() => setSelectedCityForAgency(city)} className="bg-white p-5 rounded-2xl border border-[#EEE] shadow-sm flex justify-between items-center cursor-pointer hover:border-orange-200 transition group"><div><span className="text-orange-500 bg-orange-50 px-2 py-0.5 rounded text-xs font-bold mb-1 inline-block">ê²€ìƒ‰ê²°ê³¼</span><div className="font-bold text-gray-700 text-lg group-hover:text-orange-500 transition">{city.name}</div></div><button className="bg-gray-100 text-gray-500 px-3 py-2 rounded-xl text-sm font-bold group-hover:bg-orange-500 group-hover:text-white transition">ê°€ê²© í™•ì¸ ğŸ‘‰</button></div>))) : (<div className="text-center text-gray-400 py-10"><p className="mb-2 text-2xl">ğŸ¥²</p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì–´ìš”.<br/><span className="text-xs">ì§ì ‘ ì°¾ì•„ë³´ì‹œê² ì–´ìš”?</span><button onClick={() => setSelectedCityForAgency({name: 'ì§ì ‘ ê²€ìƒ‰'})} className="mt-4 bg-orange-400 text-white px-4 py-2 rounded-xl text-sm font-bold block mx-auto">ì‚¬ì´íŠ¸ ë°”ë¡œê°€ê¸°</button></div>)) : (
                            <>
                                <div className="flex items-center gap-2 mb-2 px-1"><Sparkles className="w-4 h-4 text-yellow-500" /><span className="text-sm font-bold text-gray-500">ì˜¤ëŠ˜ì˜ ì¶”ì²œ íŠ¹ê°€</span></div>
                                <div onClick={() => setSelectedCityForAgency({name: 'í›„ì¿ ì˜¤ì¹´'})} className="bg-white p-5 rounded-2xl border border-[#EEE] shadow-sm flex justify-between items-center cursor-pointer hover:border-orange-200 transition group"><div><span className="text-sky-500 bg-sky-50 px-2 py-0.5 rounded text-xs font-bold">ì¸ê¸°</span><div className="font-bold mt-1 group-hover:text-orange-500">ì¸ì²œ â†” í›„ì¿ ì˜¤ì¹´</div></div><div className="font-bold text-lg text-[#333]">189,000ì›~</div></div>
                                <div onClick={() => setSelectedCityForAgency({name: 'ë‹¤ë‚­'})} className="bg-white p-5 rounded-2xl border border-[#EEE] shadow-sm flex justify-between items-center cursor-pointer hover:border-orange-200 transition group"><div><span className="text-pink-500 bg-pink-50 px-2 py-0.5 rounded text-xs font-bold">íŠ¹ê°€</span><div className="font-bold mt-1 group-hover:text-orange-500">ë‹¤ë‚­ 5ì„±ê¸‰ ë¦¬ì¡°íŠ¸</div></div><div className="font-bold text-lg text-[#333]">120,000ì›~</div></div>
                                <div onClick={() => setSelectedCityForAgency({name: 'ë°©ì½•'})} className="bg-white p-5 rounded-2xl border border-[#EEE] shadow-sm flex justify-between items-center cursor-pointer hover:border-orange-200 transition group"><div><span className="text-green-500 bg-green-50 px-2 py-0.5 rounded text-xs font-bold">ë§ˆê°ì„ë°•</span><div className="font-bold mt-1 group-hover:text-orange-500">ë°©ì½• ììœ ì—¬í–‰</div></div><div className="font-bold text-lg text-[#333]">320,000ì›~</div></div>
                            </>
                        )}
                    </div>
                </div>
            );
        }

        function ReviewBoard({ userPoints, setUserPoints, user, openLogin }) {
             const [reviews, setReviews] = useState(() => {
                 try {
                     const saved = localStorage.getItem('yeoja_reviews');
                     const parsed = saved ? JSON.parse(saved) : [];
                     return parsed.map(r => ({...r, rating: r.rating || 5, date: r.date || new Date().toLocaleDateString()}));
                 } catch (e) { return [{id:1, user:'ì—¬í–‰ì¡°ì•„', content:'ì¶”ì²œí•´ìš”!', city:'ë°œë¦¬', rating: 5, date:'2023.10.01'}]; }
             });
             const [text, setText] = useState('');
             const [rating, setRating] = useState(5);
             const [isAllReviewsOpen, setIsAllReviewsOpen] = useState(false);
             const [editingId, setEditingId] = useState(null);
             const [editForm, setEditForm] = useState({ text: '', rating: 5 });

             useEffect(() => localStorage.setItem('yeoja_reviews', JSON.stringify(reviews)), [reviews]);
             const handleSubmit = (e) => { e.preventDefault(); if(!user) return openLogin(); if(!text.trim()) return; setReviews([{id:Date.now(), user:user.name, content:text, city:'ì—¬í–‰ì¤‘', rating, date:new Date().toLocaleDateString()}, ...reviews]); setText(''); setRating(5); setUserPoints(p=>p+300); alert('300P ì ë¦½!'); };
             const handleDelete = (id) => { if(confirm("ì‚­ì œí• ê¹Œìš”?")) setReviews(reviews.filter(r=>r.id!==id)); };
             const startEdit = (r) => { setEditingId(r.id); setEditForm({text:r.content, rating:r.rating}); };
             const saveEdit = (id) => { setReviews(reviews.map(r=>r.id===id ? {...r, content:editForm.text, rating:editForm.rating} : r)); setEditingId(null); };

             const StarRating = ({ score, setScore, editable }) => <div className="flex gap-1">{[1,2,3,4,5].map(s => <i key={s} className={`fa-solid fa-star text-xs ${s<=score?'text-yellow-400':'text-gray-300'} ${editable?'cursor-pointer hover:scale-110':''}`} onClick={()=>editable&&setScore(s)}></i>)}</div>;

             return (
                <div className="bg-white rounded-[24px] border border-[#F0E6D8] p-5 h-[500px] flex flex-col relative">
                    {isAllReviewsOpen && (
                        <div className="absolute inset-0 z-50 bg-white rounded-[24px] p-5 flex flex-col animate-pop">
                            <div className="flex justify-between items-center mb-4 border-b pb-2"><h3 className="font-bold text-lg">ì „ì²´ ë¦¬ë·° ({reviews.length})</h3><button onClick={() => setIsAllReviewsOpen(false)}><X className="w-5 h-5 text-gray-400" /></button></div>
                            <div className="flex-1 overflow-y-auto space-y-3 scrollbar-hide">{reviews.map(r => <div key={r.id} className="bg-[#FAFAFA] p-3 rounded-xl border border-[#EEE]"><div className="flex justify-between items-start mb-1"><div><span className="font-bold text-sm text-gray-700 mr-2">{r.user}</span><span className="text-[10px] text-gray-400">{r.date}</span></div><StarRating score={r.rating} /></div><p className="text-sm text-gray-600">{r.content}</p></div>)}</div>
                        </div>
                    )}
                    <div className="mb-2 font-bold border-b pb-2 flex justify-between items-center"><span className="flex items-center gap-2"><MessageSquare className="w-4 h-4 text-orange-400"/> ë…¸ë§ˆë“œ í†¡</span><span className="text-xs text-gray-400 font-normal">ì´ {reviews.length}ê°œ</span></div>
                    <div className="flex-1 overflow-y-auto space-y-3 mb-4 scrollbar-hide">
                        {reviews.slice(0, 5).map(r => (
                            <div key={r.id} className="bg-[#FAFAFA] p-3 rounded-xl border border-[#EEE] group">
                                {editingId === r.id ? (
                                    <div className="space-y-2"><div className="flex justify-between"><StarRating score={editForm.rating} setScore={(s)=>setEditForm({...editForm, rating:s})} editable /><div className="flex gap-1"><button onClick={()=>saveEdit(r.id)} className="text-xs bg-green-100 text-green-600 px-2 py-1 rounded">ì €ì¥</button><button onClick={()=>setEditingId(null)} className="text-xs bg-gray-100 text-gray-500 px-2 py-1 rounded">ì·¨ì†Œ</button></div></div><textarea className="w-full p-2 text-sm border rounded-lg" value={editForm.text} onChange={(e)=>setEditForm({...editForm, text:e.target.value})} /></div>
                                ) : (
                                    <><div className="flex justify-between items-start mb-1"><div className="flex items-center gap-1"><span className="font-bold text-xs text-gray-700">{r.user}</span><StarRating score={r.rating} /></div>{user && user.name === r.user && (<div className="flex gap-2 opacity-0 group-hover:opacity-100 transition"><Edit className="w-3 h-3 text-gray-400 cursor-pointer hover:text-blue-500" onClick={()=>startEdit(r)} /><Trash className="w-3 h-3 text-gray-400 cursor-pointer hover:text-red-500" onClick={()=>handleDelete(r.id)} /></div>)}</div><p className="text-sm text-gray-600 leading-snug">{r.content}</p></>
                                )}
                            </div>
                        ))}
                        {reviews.length > 5 && <button onClick={() => setIsAllReviewsOpen(true)} className="w-full text-xs text-gray-400 py-2 hover:text-gray-600">ì „ì²´ ë¦¬ë·° ë³´ê¸° ({reviews.length}) ğŸ‘‡</button>}
                    </div>
                    <form onSubmit={handleSubmit} className="relative pt-2 border-t border-gray-100">
                        <div className="flex justify-between items-center mb-2 px-1"><span className="text-xs text-gray-500">ë³„ì ì„ ì„ íƒí•˜ì„¸ìš”</span><StarRating score={rating} setScore={setRating} editable /></div>
                        <div className="relative"><input value={text} onChange={e=>setText(e.target.value)} className="w-full p-3 pr-10 bg-[#FAFAFA] rounded-xl outline-none text-sm transition focus:bg-white focus:ring-2 focus:ring-orange-100" placeholder={user ? "ë¦¬ë·°ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš” (300P)" : "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤"} disabled={!user}/><button className="absolute right-3 top-1/2 transform -translate-y-1/2 text-orange-400 hover:scale-110 transition"><Send className="w-4 h-4"/></button></div>
                    </form>
                </div>
            );
        }

        function AdModal({ onClose, onReward }) {
            const [timeLeft, setTimeLeft] = useState(3);
            const [canClose, setCanClose] = useState(false);

            useEffect(() => {
                if (timeLeft > 0) {
                    const timer = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);
                    return () => clearTimeout(timer);
                } else {
                    setCanClose(true);
                }
            }, [timeLeft]);

            const handleReward = () => {
                alert("ğŸ‰ ê´‘ê³  ì‹œì²­ ì™„ë£Œ!\n300 í¬ì¸íŠ¸ê°€ ì ë¦½ë˜ì—ˆìŠµë‹ˆë‹¤.\n(ë‚˜ì¤‘ì— í˜„ê¸ˆìœ¼ë¡œ ëŒë ¤ë°›ìœ¼ì„¸ìš”!)");
                onReward();
            };

            return (
                <div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4">
                    <div className="bg-white w-full max-w-sm rounded-[2rem] p-6 text-center relative animate-pop">
                        {!canClose && <div className="absolute top-4 right-4 text-xs bg-gray-200 px-2 py-1 rounded text-gray-500">ë‚¨ì€ ì‹œê°„: {timeLeft}ì´ˆ</div>}
                        <div className="w-full h-48 bg-gray-900 rounded-xl mb-6 flex flex-col items-center justify-center text-white relative overflow-hidden">
                            <div className="absolute inset-0 bg-gradient-to-br from-purple-500 to-indigo-600 opacity-50"></div>
                            <PlayCircle className="w-12 h-12 mb-2 z-10" />
                            <p className="z-10 font-bold">íŠ¹ê°€ í•­ê³µê¶Œ ê´‘ê³  ì¬ìƒ ì¤‘...</p>
                            <div className="w-full bg-gray-700 h-1 absolute bottom-0 left-0"><div className="bg-orange-500 h-full transition-all duration-1000 ease-linear" style={{ width: `${(3 - timeLeft) * 33.3}%` }}></div></div>
                        </div>
                        <h3 className="text-xl font-bold text-[#444] mb-2">í¬ì¸íŠ¸ë¥¼ ì ë¦½ ì¤‘ì…ë‹ˆë‹¤!</h3>
                        {canClose ? <button onClick={handleReward} className="w-full bg-orange-500 text-white py-3 rounded-xl font-bold text-lg hover:bg-orange-600 transition shadow-md animate-bounce">ğŸ’° 300P ë°›ê¸° (ë‹«ê¸°)</button> : <button disabled className="w-full bg-gray-200 text-gray-400 py-3 rounded-xl font-bold cursor-not-allowed">ì‹œì²­ ì¤‘... ({timeLeft})</button>}
                    </div>
                </div>
            );
        }

        // ğŸ†• LoginModalì´ ì´ì œ initialViewë¥¼ ë°›ìŠµë‹ˆë‹¤.
        function LoginModal({ onClose, onLogin, initialView = 'login' }) {
            const [view, setView] = useState(initialView);
            const [loginForm, setLoginForm] = useState({ id: '', password: '' });
            const [signupForm, setSignupForm] = useState({ name: '', gender: 'female', birth: '', phone: '', email: '', id: '', password: '' });
            const [idCheckStatus, setIdCheckStatus] = useState('none');
            const [nameError, setNameError] = useState('');

            const getRegisteredUsers = () => { 
                try {
                    const users = localStorage.getItem('yeoja_users'); 
                    return users ? JSON.parse(users) : []; 
                } catch(e) { return []; }
            };
            const containsBannedWords = (text) => BANNED_WORDS.some(word => text.includes(word));

            const handleIdCheck = () => {
                const { id } = signupForm;
                if (!id) { alert('ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
                if (containsBannedWords(id)) { setIdCheckStatus('banned'); return; }
                const registeredUsers = getRegisteredUsers();
                const isDuplicate = registeredUsers.some(u => u.id === id) || ['admin', 'test'].includes(id);
                setIdCheckStatus('checking');
                setTimeout(() => { if (isDuplicate) setIdCheckStatus('duplicate'); else setIdCheckStatus('available'); }, 300);
            };

            const handleSignupSubmit = () => {
                if (!signupForm.name || !signupForm.id || !signupForm.password || !signupForm.phone) { alert('ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
                if (containsBannedWords(signupForm.name)) { setNameError('ğŸš« ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ì´ë¦„(ë‹‰ë„¤ì„)ì…ë‹ˆë‹¤.'); return; } else { setNameError(''); }
                if (idCheckStatus !== 'available') { alert('ì•„ì´ë”” ì¤‘ë³µ í™•ì¸ì„ í•´ì£¼ì„¸ìš”.'); return; }
                const registeredUsers = getRegisteredUsers();
                registeredUsers.push({ ...signupForm });
                localStorage.setItem('yeoja_users', JSON.stringify(registeredUsers));
                alert('ğŸ‰ íšŒì›ê°€ì… ì„±ê³µ! ì´ì œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                setView('login');
            };

            const handleLoginSubmit = () => {
                if (!loginForm.id || !loginForm.password) { alert('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
                const registeredUsers = getRegisteredUsers();
                const foundUser = registeredUsers.find(u => u.id === loginForm.id && u.password === loginForm.password);
                if (foundUser) { onLogin({ name: foundUser.name, id: foundUser.id }); } else { alert('ğŸš« ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\n(íšŒì›ê°€ì…ì„ ë¨¼ì € í•´ì£¼ì„¸ìš”!)'); }
            };

            return (
                <div className="fixed inset-0 bg-black/40 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                    <div className="bg-white p-8 rounded-[2rem] w-full max-w-sm soft-shadow animate-pop relative max-h-[90vh] overflow-y-auto scrollbar-hide">
                        <button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-gray-600"><X className="w-6 h-6" /></button>
                        {view === 'login' ? (
                            <div className="text-center">
                                <h2 className="text-2xl text-[#444] mb-2 font-bold">ë¡œê·¸ì¸</h2>
                                <p className="text-[#999] mb-8 text-sm">ë°˜ê°€ì›Œìš”! ì˜¤ëŠ˜ë„ ë– ë‚˜ë³¼ê¹Œìš”?</p>
                                <div className="space-y-3">
                                    <input type="text" placeholder="ì•„ì´ë””" className="input-base" value={loginForm.id} onChange={(e) => setLoginForm({...loginForm, id: e.target.value})} />
                                    <input type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" className="input-base" value={loginForm.password} onChange={(e) => setLoginForm({...loginForm, password: e.target.value})} />
                                    <button onClick={handleLoginSubmit} className="w-full bg-orange-400 text-white py-4 rounded-xl text-lg hover:bg-orange-500 transition shadow-md btn-press mt-2 font-bold">ë¡œê·¸ì¸</button>
                                </div>
                                <div className="mt-8 pt-6 border-t border-[#F5F5F5]"><p className="text-xs text-[#AAA] mb-2">ì•„ì§ ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”?</p><button onClick={() => setView('signup')} className="text-orange-500 font-bold hover:underline text-sm">3ì´ˆ ë§Œì— íšŒì›ê°€ì… í•˜ëŸ¬ê°€ê¸° ğŸ‘‰</button></div>
                            </div>
                        ) : (
                            <div>
                                <div className="flex items-center gap-2 mb-6"><button onClick={() => setView('login')} className="p-1 hover:bg-gray-100 rounded-full"><ArrowLeft className="w-5 h-5 text-gray-500" /></button><h2 className="text-2xl text-[#444] font-bold">íšŒì›ê°€ì…</h2></div>
                                <div className="space-y-4">
                                    <div><label className="block text-xs text-gray-500 mb-1 ml-1">ì´ë¦„ (ë‹‰ë„¤ì„)</label><input type="text" className="input-base" value={signupForm.name} onChange={(e) => { setSignupForm({...signupForm, name: e.target.value}); if(nameError) setNameError(''); }} />{nameError && <p className="text-red-500 text-xs mt-1 ml-1">{nameError}</p>}</div>
                                    <div><label className="block text-xs text-gray-500 mb-1 ml-1">ì•„ì´ë””</label><div className="flex gap-2"><input type="text" className="input-base flex-1" value={signupForm.id} onChange={(e) => { setSignupForm({...signupForm, id: e.target.value}); setIdCheckStatus('none'); }} /><button onClick={handleIdCheck} className="bg-gray-100 text-gray-600 px-4 rounded-xl text-xs font-bold hover:bg-gray-200 transition whitespace-nowrap">ì¤‘ë³µí™•ì¸</button></div>{idCheckStatus === 'available' && <p className="text-green-500 text-xs mt-1 ml-1">ì‚¬ìš© ê°€ëŠ¥!</p>}{idCheckStatus === 'duplicate' && <p className="text-red-500 text-xs mt-1 ml-1">ì´ë¯¸ ìˆì–´ìš”!</p>}</div>
                                    <div><label className="block text-xs text-gray-500 mb-1 ml-1">ë¹„ë°€ë²ˆí˜¸</label><input type="password" className="input-base" value={signupForm.password} onChange={(e) => setSignupForm({...signupForm, password: e.target.value})} /></div>
                                    <div><label className="block text-xs text-gray-500 mb-1 ml-1">ì—°ë½ì²˜</label><input type="tel" className="input-base" value={signupForm.phone} onChange={(e) => setSignupForm({...signupForm, phone: e.target.value})} /></div>
                                    <button onClick={handleSignupSubmit} className="w-full bg-orange-400 text-white py-4 rounded-xl text-lg hover:bg-orange-500 transition shadow-md btn-press mt-4 font-bold">ê°€ì…ì™„ë£Œ</button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // =========================================================================
        // 4. ë©”ì¸ ì•± ì»´í¬ë„ŒíŠ¸
        // =========================================================================
        function App() {
            const [currentPage, setCurrentPage] = useState('home');
            
            // ğŸš¨ [ì•ˆì „ ëª¨ë“œ] ë°ì´í„° ë³µêµ¬ ë¡œì§ (ì—ëŸ¬ ë°œìƒ ì‹œ ì´ˆê¸°í™”)
            const [userPoints, setUserPoints] = useState(() => {
                try {
                    const saved = localStorage.getItem('yeoja_points');
                    const parsed = parseInt(saved, 10);
                    return isNaN(parsed) ? 0 : parsed;
                } catch (e) {
                    return 0; 
                }
            });

            // ğŸš¨ [ì•ˆì „ ëª¨ë“œ] ë¡œê·¸ì¸ ì •ë³´ ë³µêµ¬ ë¡œì§
            const [user, setUser] = useState(() => {
                try {
                    const sessionUser = sessionStorage.getItem('yeoja_current_user');
                    return sessionUser ? JSON.parse(sessionUser) : null;
                } catch (e) {
                    sessionStorage.removeItem('yeoja_current_user');
                    return null;
                }
            });

            const [authView, setAuthView] = useState(null); 
            const [isAdModalOpen, setIsAdModalOpen] = useState(false);

            useEffect(() => {
                localStorage.setItem('yeoja_points', userPoints);
            }, [userPoints]);

            const handleLoginSuccess = (userData) => {
                setUser(userData);
                sessionStorage.setItem('yeoja_current_user', JSON.stringify(userData));
                setAuthView(null);
            };

            const handleLogout = () => {
                setUser(null);
                sessionStorage.removeItem('yeoja_current_user');
            };

            return (
                <div className="min-h-screen bg-[#F9F5F0] text-[#5A5A5A] font-sans flex flex-col items-center selection:bg-orange-200">
                    {/* ëª¨ë‹¬ì— í˜„ì¬ ë³´ê³  ì‹¶ì€ í™”ë©´(initialView) ì „ë‹¬ */}
                    {authView && (
                        <LoginModal 
                            initialView={authView}
                            onClose={() => setAuthView(null)} 
                            onLogin={handleLoginSuccess} 
                        />
                    )}

                    {isAdModalOpen && (
                        <AdModal 
                            onClose={() => setIsAdModalOpen(false)}
                            onReward={() => {
                                setUserPoints(prev => prev + 300);
                                setIsAdModalOpen(false);
                            }}
                        />
                    )}

                    <header className="w-full max-w-6xl px-6 py-6 flex justify-between items-center sticky top-0 bg-[#F9F5F0]/90 backdrop-blur-sm z-40">
                        <div className="flex items-center gap-3 cursor-pointer group" onClick={() => setCurrentPage('home')}>
                            <div className="bg-orange-400 text-white p-2.5 rounded-2xl shadow-sm transform group-hover:rotate-12 transition duration-300">
                                <Plane className="w-6 h-6" />
                            </div>
                            <h1 className="text-3xl text-[#4A4A4A] tracking-wider group-hover:text-orange-500 transition">YEOJA</h1>
                        </div>
                        
                        <div className="flex items-center gap-4">
                            {/* ğŸ†• ìˆ˜ì •ëœ ë¶€ë¶„: ë¡œê·¸ì¸ì„ í–ˆì„ ë•Œë§Œ í¬ì¸íŠ¸ê°€ ë³´ì…ë‹ˆë‹¤! */}
                            {user && (
                                <div className="flex items-center gap-2 bg-white px-4 py-2 rounded-full border border-orange-200 shadow-sm">
                                    <div className="w-5 h-5 bg-yellow-400 rounded-full flex items-center justify-center text-white text-xs font-bold">$</div>
                                    <span className="text-orange-500 font-bold">{userPoints.toLocaleString()} P</span>
                                </div>
                            )}
                            
                            {user ? (
                                <div className="hidden md:flex items-center gap-2 text-sm font-medium text-[#555] bg-white border border-[#E0E0E0] px-4 py-2 rounded-full shadow-sm">
                                    <User className="w-4 h-4 text-orange-400" />
                                    <span>{user.name}ë‹˜</span>
                                    <button onClick={handleLogout} className="text-xs text-[#AAA] ml-2 hover:text-red-400">(ë¡œê·¸ì•„ì›ƒ)</button>
                                </div>
                            ) : (
                                // ğŸ†• ë¡œê·¸ì¸ / íšŒì›ê°€ì… ë²„íŠ¼ ë¶„ë¦¬
                                <div className="flex gap-2">
                                    <button 
                                        onClick={() => setAuthView('login')}
                                        className="hidden md:flex items-center gap-2 text-sm font-medium text-[#7A7A7A] bg-white border border-[#E0E0E0] px-4 py-2 rounded-full cursor-pointer hover:bg-orange-50 hover:border-orange-200 hover:text-orange-500 transition shadow-sm"
                                    >
                                        <LogIn className="w-4 h-4" />
                                        ë¡œê·¸ì¸
                                    </button>
                                    <button 
                                        onClick={() => setAuthView('signup')}
                                        className="hidden md:flex items-center gap-2 text-sm font-bold text-white bg-orange-400 border border-orange-400 px-4 py-2 rounded-full cursor-pointer hover:bg-orange-500 hover:scale-105 transition shadow-sm"
                                    >
                                        <UserPlus className="w-4 h-4" />
                                        íšŒì›ê°€ì…
                                    </button>
                                </div>
                            )}
                        </div>
                    </header>

                    <main className="w-full max-w-6xl flex-1 flex flex-col md:flex-row gap-6 p-4">
                        <aside className="w-full md:w-1/4 space-y-4">
                            <RankingBox icon={<Smile className="w-5 h-5 text-orange-400" />} title="ê°€ì¡± ì—¬í–‰ ì¸ê¸° TOP" data={WEEKLY_RANKING_DATA.family} />
                            <RankingBox icon={<Heart className="w-5 h-5 text-rose-400" />} title="ì»¤í”Œ ì—¬í–‰ ì¸ê¸° TOP" data={WEEKLY_RANKING_DATA.couple} />
                            <RankingBox icon={<Briefcase className="w-5 h-5 text-blue-400" />} title="ë‚˜í˜¼ì ì—¬í–‰ TOP" data={WEEKLY_RANKING_DATA.solo} />
                        </aside>

                        <section className="flex-1 min-h-[600px] bg-white rounded-[24px] border border-[#F0E6D8] p-8 relative soft-shadow">
                            {currentPage !== 'home' && (
                                <button onClick={() => setCurrentPage('home')} className="absolute top-6 left-6 flex items-center text-[#999] hover:text-[#555] text-lg transition z-10 font-medium">
                                    <ArrowLeft className="w-5 h-5 mr-1" /> ëŒì•„ê°€ê¸°
                                </button>
                            )}
                            {currentPage === 'home' && <HomeMenu setPage={setCurrentPage} />}
                            {currentPage === 'calc' && <CostCalculator />}
                            {currentPage === 'budget' && <BudgetRecommender />}
                            {currentPage === 'mbti' && <MbtiAnalyzer />}
                            {currentPage === 'search' && <RealTimeSearch />}
                        </section>

                        <aside className="w-full md:w-1/4 flex flex-col gap-4 h-full">
                            <div 
                                onClick={() => {
                                    if (!user) {
                                        alert("íšŒì›ë§Œ í¬ì¸íŠ¸ë¥¼ ì ë¦½í•  ìˆ˜ ìˆì–´ìš”! ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”.");
                                        setAuthView('login');
                                        return;
                                    }
                                    setIsAdModalOpen(true);
                                }}
                                className="bg-gradient-to-r from-orange-400 to-pink-500 text-white p-4 rounded-2xl soft-shadow cursor-pointer hover:scale-105 transition btn-press flex items-center gap-3 relative overflow-hidden"
                            >
                                <div className="bg-white/20 p-2 rounded-full"><PlayCircle className="w-6 h-6 text-white" /></div>
                                <div><div className="font-bold text-lg">ê´‘ê³  ë³´ê³  300P</div><div className="text-xs text-orange-100 flex items-center gap-1"><Gift className="w-3 h-3"/> í˜„ê¸ˆ í˜ì´ë°± ì ë¦½!</div></div>
                                <div className="absolute -right-2 -bottom-2 w-16 h-16 bg-white/10 rounded-full blur-xl"></div>
                            </div>
                            <ReviewBoard userPoints={userPoints} setUserPoints={setUserPoints} user={user} openLogin={() => setAuthView('login')} />
                        </aside>
                    </main>
                    
                    <footer className="w-full text-center p-8 text-[#CCC] text-sm font-light">Â© 2025 YEOJA. Your Travel Mate.</footer>
                </div>
            );
        }

        // ì•± ë Œë”ë§
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
